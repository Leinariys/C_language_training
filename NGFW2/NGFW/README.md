# Программа: NGFW (Next-Generation Firewall)

## Описание:

В рамках курсовой работы была реализована система фильтрации и мониторинга сетевого трафика на портах.
Основная цель проекта заключалась в возможности фильтрации пакетов по IP-адресам и обнаружении содержимого пакетов, не
соответствующего HTTP протоколу.
Дополнительной функциональностью является перенаправление сообщений с сервера с глобальным IP-адресом на сервер без
глобального IP.
Применение такой системы позволяет уменьшить нагрузку на приложение, отсекая нежелательный трафик как по IP-адресам, так
и по содержимому пакетов.
Проект разрабатывался для личного использования и представлен в виде курсовой работы.

Программа NGFW является примером брандмауэра, который перенаправляет трафик между клиентами и целевым сервером.

## Запланированный функционал (TODO):

- Реализация фильтрации пакетов для обеспечения безопасности сетевого трафика, включая фильтрацию по IP черному/белому
  списку.
- Разработка механизма обнаружения и предотвращения атак на сеть.
- Добавление логирования событий для анализа сетевой активности.
- Реализация обработчиков ошибок, включая разрыв соединения и закрытие потоков.
- Возможное разделение метода `handleConnection` на более мелкие методы для улучшения читаемости кода.

# Инструкции по установке CMake и сборке проекта

Этот файл содержит инструкции о том, как установить CMake и запустить сборку проекта.

## Установка CMake

1. Скачайте установщик CMake с [официального сайта](https://cmake.org/download/).
2. Запустите установщик и следуйте инструкциям на экране.
3. При установке убедитесь, что у вас выбраны нужные опции (например, добавление CMake в переменные среды PATH).

## Сборка проекта с помощью CMake

1. Создайте директорию для сборки проекта, например, `build/`.
2. Откройте командную строку и перейдите в директорию сборки.
3. Запустите следующие команды:

   ```cmd
    set CC=C:/Users/leina/AppData/Local/Programs/CLion/bin/mingw/bin/gcc.exe
   C:\Users\leina\AppData\Local\Programs\CLion\bin\cmake\win\x64\bin\cmake.exe -DCMAKE_BUILD_TYPE=Debug -DCMAKE_MAKE_PROGRAM=C:/Users/leina/AppData/Local/Programs/CLion/bin/ninja/win/x64/ninja.exe -G Ninja -S C:\Projects\Ch\NGFW -B C:\Projects\Ch\NGFW\cmake-build-debug -DCMAKE_C_COMPILER=C:/Users/leina/AppData/Local/Programs/CLion/bin/mingw/bin/gcc.exe
   C:\Users\leina\AppData\Local\Programs\CLion\bin\cmake\win\x64\bin\cmake.exe --build C:\Projects\Ch\NGFW\cmake-build-debug --target NGFW -j 22

4. После завершения сборки вы можете найти собранный проект в директории сборки NGFW.exe.

## Пример запуска NGFW (Next-Generation Firewall):

Цель демонстрации показать пересылку пакета сообщения с одного порта на другой через NGFW

Для запуска программы необходимо передать следующие аргументы:

-I 127.0.0.1 -i 80 -O 127.0.0.1 -o 80 -C 127.0.0.1 -c 80 -F 15 -T 5,8,2

- IP-адрес для входящего порта: 192.168.1.10
- Порт для входящего порта: 8011
- IP-адрес для исходящего порта: 127.0.0.1
- Порт для исходящего порта: 8077

Пример запуска программы с передачей аргументов:
{program_name} 192.168.1.10 8011 127.0.0.1 8077

Проверим доступность приложения по порту из браузера
Локально: 8077 - Доступен
Внешний: 8011 - Не доступен

Запускаем NGFW - подобие примера на брандмауэр

Проверим доступность приложения по порту из браузера
Внешний: 8011 - Доступен, можно блокировать и набирать статистику по содержимому пакетов(функционал не реализован)

//Тестирование не работает

//(New-Object System.Net.Sockets.UdpClient).Send([System.Text.Encoding]::ASCII.GetBytes("YourMessage"),"YourMessage"
.Length,(New-Object System.Net.IPEndPoint ([System.Net.IPAddress]::Parse("127.0.0.1"), 8125)))
//(New-Object System.Net.Sockets.TcpClient).Connect("192.168.1.10", 8125).GetStream().Write([System.Text.Encoding]::
ASCII.GetBytes("YourMessage"), 0, "YourMessage".Length)

//Данные

MSG_OOB:
Значение: 0x1
Поведение: Используется для приема внебандовых (out-of-band) данных.

MSG_PEEK:
Значение: 0x2
Поведение: Позволяет просмотреть данные во входящем сетевом потоке без удаления их из очереди приема.

MSG_DONTROUTE (0x4):
Этот флаг указывает на то, что данные не должны быть маршрутизированы и должны быть отправлены только на локальный
интерфейс. Это может быть полезно, когда нужно избежать маршрутизации данных через сеть.

MSG_WAITALL:
Значение: 0x100
Поведение: Требует, чтобы функция recv() вернула только после того, как было получено все запрошенное количество данных,
или если соединение было закрыто.

MSG_PARTIAL (0x8000):
Этот флаг указывает на то, что операция может быть частичной, т.е. функция recv() может вернуть меньшее количество
данных, чем запрошено. Это обычно используется в ситуациях, когда необходимо принять только часть данных и продолжить
ожидание оставшихся данных.

MSG_INTERRUPT (0x10):
Этот флаг используется для прерывания операции ввода-вывода, связанной с сокетом. Он может быть использован для
прерывания блокирующей операции recv() в случае необходимости.

MSG_MAXIOVLEN (16):
Это максимальное количество элементов (структур iovec), которые могут быть переданы в одном вызове функции recvmsg().
Структура iovec используется для передачи данных через несколько буферов одновременно.

definitions.h: Общие определения (#define DIRECTIVES)
string_replacement.h/string_replacement.c: Функции для замены строк в буфере
socket_io.h/socket_io.c: функции чтения и записи данных с сокетов
connection_handler.h/connection_handler.c: Обработка соединений, включая создание и подключение к сокетам и передачу
данных между портами
server.h/server.c: Запуск сервера и принятие входящих соединений

project_folder/
│
├── src/ (исходный код)
│ ├── main.c
│ ├── module1.c
│ ├── module2.c
│
├── include/ (локальные заголовочные файлы)
│ ├── project_header1.h
│ ├── project_header2.h
│
├── resources/ (ресурсы)
│ ├── data.txt
│ ├── images/
│ ├── image1.png
│ ├── image2.jpg
│
├── lib/ (внешние библиотеки)
│ ├── lib1/
│ ├── include/ (заголовочные файлы lib1)
│ ├── lib/ (скомпилированные файлы lib1)
│ ├── lib2/
│ ├── include/ (заголовочные файлы lib2)
│ ├── lib/ (скомпилированные файлы lib2)
│
├── [cmake-build-debug](cmake-build-debug)/ (скомпилированные файлы)
│
└── README.md


